<?xml version="1.0"?>
  <database name="VIEW TMC_DOCUMENTUPDATELINE_V">
    <view name="TMC_DOCUMENTUPDATELINE_V"><![CDATA[SELECT DISTINCT ON (cr.tmc_car_id) dl.tmc_documentupdateline_id AS tmc_documentupdateline_v_id, dl.ad_client_id, dl.ad_org_id, dl.isactive, dl.created, dl.createdby, dl.updated, dl.updatedby, bp.name AS customername, cr.name AS car, tmc.documentno, dl.tgl_isi_pulsa_reg AS tanggalisipulsareguler, dl.nom_isi_pulsa_reg AS nominalisipulsareguler, dl.tgl_isi_pulsa_quota AS tanggalisipulsaquota, dl.nom_isi_pulsa_quota AS nominalisipulsaquota, dl.maintenancedatefrom, dl.maintenancedateto, tmc_getdayinterval(dl.maintenancedateto, dl.maintenancedatefrom) AS period, dl.pengisianke, tmc_getdayinterval(dl.maintenancedateto, dl.maintenancedatefrom) - dl.pengisianke AS sisapengisian, dl.tgl_isi_pulsa_reg AS tanggalterakhirisipulsareguler, dl.tgl_isi_pulsa_reg + '1 mon' AS tanggalpengisianpulsaregulerberikutnya, dl.tgl_isi_pulsa_quota AS tanggalterakhirisipulsaquota, dl.tgl_isi_pulsa_quota + '1 mon' AS tanggalpengisianpulsaquotaberikutnya, CASE WHEN date_part('days', age(now(), ((dl.tgl_isi_pulsa_reg + '1 mon') + 1))) = 0 precision THEN 'Hari ini adalah jadwal pengisian' WHEN date_part('days', age(now(), ((dl.tgl_isi_pulsa_reg + '1 mon') + 1))) > 0 precision THEN ('Terlewat ' || date_part('days', age(now(), ((dl.tgl_isi_pulsa_reg + '1 mon') + 1)))) || ' hari dari jadwal yang ditetapkan' ELSE ('Masih terjadwal dengan baik ' || abs(date_part('days', age(now(), ((dl.tgl_isi_pulsa_reg + '1 mon') + 1))))) || ' hari lagi adalah jadwal pengisian' END AS statusjadwalpulsareguler, CASE WHEN date_part('days', age(now(), ((dl.tgl_isi_pulsa_reg + '1 mon') + 1))) = 0 precision THEN 'Hari ini adalah jadwal pengisian' WHEN date_part('days', age(now(), ((dl.tgl_isi_pulsa_quota + '1 mon') + 1))) > 0 precision THEN ('Terlewat ' || date_part('days', age(now(), ((dl.tgl_isi_pulsa_quota + '1 mon') + 1)))) || ' hari dari jadwal yang ditetapkan' ELSE ('Masih terjadwal dengan baik ' || abs(date_part('days', age(now(), ((dl.tgl_isi_pulsa_quota + '1 mon') + 1))))) || ' hari lagi adalah jadwal pengisian' END AS statusjadwalpulsaquota, dl.issalesorder FROM tmc_documentupdateline dl, c_bpartner bp, tmc_car cr, tmc_documentupdate tmc WHERE dl.status = 'Maintenance Pulsa atau Quota' AND bp.c_bpartner_id = dl.c_bpartner_id AND cr.tmc_car_id = dl.tmc_car_id AND bp.c_bpartner_id = dl.c_bpartner_id AND (abs(date_part('month', age(dl.maintenancedatefrom, dl.maintenancedateto))) - dl.pengisianke precision) <> 0 precision AND to_date(now()) >= dl.maintenancedatefrom AND to_date(now()) <= dl.maintenancedateto AND tmc.tmc_documentupdate_id = dl.tmc_documentupdate_id AND dl.issalesorder = 'Y' AND (date_part('day', to_date(dl.tgl_isi_pulsa_reg)) = date_part('day', date(to_date(now()))) OR date_part('day', to_date(dl.tgl_isi_pulsa_quota)) = date_part('day', date(to_date(now())))) GROUP BY bp.name, cr.name, dl.tgl_isi_pulsa_reg, dl.nom_isi_pulsa_reg, dl.tgl_isi_pulsa_quota, dl.nom_isi_pulsa_quota, dl.maintenancedatefrom, dl.maintenancedateto, dl.pengisianke, cr.tmc_car_id, dl.created, dl.issalesorder, tmc.documentno, dl.tmc_documentupdateline_id ORDER BY cr.tmc_car_id, dl.created DESC]]></view>
  </database>
